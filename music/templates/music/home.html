{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link id="theme-stylesheet" rel="stylesheet" href="{% static 'music/light.css' %}">
</head>
<body>
<div class="navigation">
    <a href="{% url 'settings' %}" class="button">Settings</a>
    <a href="{% url 'logout' %}" class="button">Log Out</a>
    <a href="{% url 'contact_developer' %}" class="button">Contact Developer</a>
    <button id="toggle-theme">Toggle Theme</button>
</div>
<h1>Welcome to Your Spotify Wraps</h1>
<a href="{% url 'generate_wrap' %}" class="button">Generate New Wrap</a>

<h2>Your Saved Wraps</h2>
{% if wraps %}
    <ul>
        {% for wrap in wraps %}
            <li>
                <a href="{% url 'view_wrap' wrap.id %}">{{ wrap.title }} - {{ wrap.created_at }}</a>
                <a href="{% url 'delete_wrap' wrap.id %}" class="button">Delete</a>
            </li>
        {% endfor %}
    </ul>
{% else %}
    <p>No wraps saved yet. Generate your first wrap!</p>
{% endif %}

<h2>List of Games You Can Play</h2>
<a href="{% url 'musician_guess' %}" class="button">Guess Your Most Listened To Musician Game</a>
<a href="{% url 'audio_guess' %}" class="button">Guess Song based on audio Game</a>


<script>
  function setTheme(theme) {
    const themeStylesheet = document.getElementById('theme-stylesheet');
    themeStylesheet.setAttribute('href', 
        theme === 'dark' ? '{% static "music/dark.css" %}' :
        theme === 'light' ? '{% static "music/light.css" %}' :
        theme === 'colorful' ? '{% static "music/color.css" %}' :
        theme === 'orange' ? '{% static "music/orange.css" %}' :
        theme === 'red' ? '{% static "music/red.css" %}' :
        '{% static "music/light.css" %}'
    );
}

function getQueryParam(param) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(param);
}

function checkDateForTheme() {
    // Check for ?date=MM-DD in the URL
    const simulatedDate = getQueryParam('date');
    let dateKey;

    if (simulatedDate) {
        dateKey = simulatedDate; // Use the simulated date from the URL
    } else {
        const today = new Date();
        dateKey = `${today.getMonth() + 1}-${today.getDate()}`; // Use today's date
    }

    if (dateKey === '10-31') {
        setTheme('orange'); // Halloween
        return true;
    } else if (dateKey === '12-25') {
        setTheme('red'); // Christmas
        return true;
    }

    return false; // No special theme applied
}

document.addEventListener('DOMContentLoaded', () => {
    const specialThemeApplied = checkDateForTheme();
    if (!specialThemeApplied) {
        const currentTheme = localStorage.getItem('theme') || 'light';
        setTheme(currentTheme);

        const toggleButton = document.getElementById('toggle-theme');
        if (toggleButton) {
            toggleButton.onclick = () => {
                const currentTheme = localStorage.getItem('theme') || 'light';
                const newTheme = currentTheme === 'dark' ? 'light' :
                                 currentTheme === 'light' ? 'colorful' :
                                 currentTheme === 'colorful' ? 'dark' : 'light';
                localStorage.setItem('theme', newTheme);
                setTheme(newTheme);
            };
        }
    }
});

</script>
</body>
</html>