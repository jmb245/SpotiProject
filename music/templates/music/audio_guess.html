<!DOCTYPE html>
<html>
<head>
    <title>Guess the Song</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link id="theme-stylesheet" rel="stylesheet" href="{% static 'music/light.css' %}">
</head>
<body>
    <h1>Guess the Song</h1>
    <audio controls>
        <source src="{{ snippet_url }}" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>
    <form id="guess-form">
        {% for option in options %}
            <label>
                <input type="radio" name="guess" value="{{ option }}"> {{ option }}
            </label><br>
        {% endfor %}
        <input type="hidden" name="answer" value="{{ answer }}">
        <button type="button" onclick="submitGuess()">Submit</button>
    </form>
    <div id="result"></div>
    <button id="toggle-theme">Toggle Theme</button>
    
    <script>
        function submitGuess() {
            const form = document.getElementById('guess-form');
            const formData = new FormData(form);

            fetch("{% url 'check_answer' %}", {
                method: 'POST',
                body: formData,
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}'
                }
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('result').innerText = data.correct
                    ? "Correct!"
                    : "Wrong! Try again.";
            });
        }
        
        function setTheme(theme) {
        const themeStylesheet = document.getElementById('theme-stylesheet');
        themeStylesheet.setAttribute('href',
            theme === 'dark' ? '{% static 'music/dark.css' %}' :
            theme === 'light' ? '{% static 'music/light.css' %}' :
            '{% static 'music/color.css' %}' // Colorful theme
        );
    }

        document.addEventListener('DOMContentLoaded', () => {
            const currentTheme = localStorage.getItem('theme') || 'light';
            setTheme(currentTheme); // Set the initial theme based on stored value
    
            const toggleButton = document.getElementById('toggle-theme');
            toggleButton.textContent = 'Switch Theme'; // Update button text
    
            toggleButton.onclick = () => {
                // Retrieve the current theme again
                const currentTheme = localStorage.getItem('theme') || 'light';
                const newTheme = currentTheme === 'dark' ? 'light' :
                                 currentTheme === 'light' ? 'colorful' : 'dark'; // Cycle through themes
                localStorage.setItem('theme', newTheme); // Store new theme
                setTheme(newTheme); // Apply new theme
                toggleButton.textContent = 'Switch Theme'; // Update button text
            };
        }); 
    </script>
</body>
</html>
