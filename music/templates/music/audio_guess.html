<!DOCTYPE html>
<html>
<head>
    <title>Guess the Song</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link id="theme-stylesheet" rel="stylesheet" href="{% static 'music/light.css' %}">
</head>
<body>
    <h1>Guess the Song</h1>
    <audio controls>
        <source src="{{ snippet_url }}" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>
    <form id="guess-form">
        {% for option in options %}
            <label>
                <input type="radio" name="guess" value="{{ option }}"> {{ option }}
            </label><br>
        {% endfor %}
        <input type="hidden" name="answer" value="{{ answer }}">
        <button type="button" onclick="submitGuess()">Submit</button>
    </form>
    <div id="result"></div>
    <button id="toggle-theme">Toggle Theme</button>
    
    <script>
        function setTheme(theme) {
    const themeStylesheet = document.getElementById('theme-stylesheet');
    themeStylesheet.setAttribute('href', 
        theme === 'dark' ? '{% static "music/dark.css" %}' :
        theme === 'light' ? '{% static "music/light.css" %}' :
        theme === 'colorful' ? '{% static "music/color.css" %}' :
        theme === 'orange' ? '{% static "music/orange.css" %}' :
        theme === 'red' ? '{% static "music/red.css" %}' :
        '{% static "music/light.css" %}'
    );
}

function getQueryParam(param) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(param);
}

function checkDateForTheme() {
    // Check for ?date=MM-DD in the URL
    const simulatedDate = getQueryParam('date');
    let dateKey;

    if (simulatedDate) {
        dateKey = simulatedDate; // Use the simulated date from the URL
    } else {
        const today = new Date();
        dateKey = `${today.getMonth() + 1}-${today.getDate()}`; // Use today's date
    }

    if (dateKey === '10-31') {
        setTheme('orange'); // Halloween
        return true;
    } else if (dateKey === '12-25') {
        setTheme('red'); // Christmas
        return true;
    }

    return false; // No special theme applied
}

document.addEventListener('DOMContentLoaded', () => {
    const specialThemeApplied = checkDateForTheme();
    if (!specialThemeApplied) {
        const currentTheme = localStorage.getItem('theme') || 'light';
        setTheme(currentTheme);

        const toggleButton = document.getElementById('toggle-theme');
        if (toggleButton) {
            toggleButton.onclick = () => {
                const currentTheme = localStorage.getItem('theme') || 'light';
                const newTheme = currentTheme === 'dark' ? 'light' :
                                 currentTheme === 'light' ? 'colorful' :
                                 currentTheme === 'colorful' ? 'dark' : 'light';
                localStorage.setItem('theme', newTheme);
                setTheme(newTheme);
            };
        }
    }
});

        
        function submitGuess() {
            const form = document.getElementById('guess-form');
            const formData = new FormData(form);
        
            fetch("{% url 'check_answer' %}", {
                method: 'POST',
                body: formData,
                headers: { 'X-CSRFToken': '{{ csrf_token }}' }
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('result').innerText = data.correct ? "Correct!" : "Wrong! Try again.";
            });
        }
    </script>
</body>
</html>
